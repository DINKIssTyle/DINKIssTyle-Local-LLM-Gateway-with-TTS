<!DOCTYPE html>
<html lang="en">
<!--
 * Created by DINKIssTyle on 2026.
 * Copyright (C) 2026 DINKI'ssTyle. All rights reserved.
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>DKST LLM Chat</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css?v=4">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>

<body>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay" onclick="if(event.target===this)closeSettingsModal()">
        <div class="modal">
            <div class="modal-header">
                <h2 data-i18n="modal.settings.title">Settings</h2>
                <button class="modal-close" onclick="closeSettingsModal()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Language Selector -->
                <div class="lang-selector">
                    <label>ğŸŒ Language</label>
                    <select id="cfg-lang" onchange="setLanguage(this.value)">
                        <option value="ko">í•œêµ­ì–´</option>
                        <option value="en">English</option>
                    </select>
                </div>

                <!-- LLM Settings Section -->
                <div class="setting-section">
                    <div class="setting-section-title" data-i18n="section.llm">LLM Settings</div>

                    <div class="setting-item">
                        <label data-i18n="setting.model.label">Model Name</label>
                        <p class="setting-desc" data-i18n="setting.model.desc">LLMì„œë²„ì—ì„œ í˜„ì¬ ë¡œë“œë˜ì–´ ìˆëŠ” ëª¨ë¸ ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.</p>
                        <select id="cfg-model">
                            <option value="">Loading models...</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.llmMode.label">Connection Mode</label>
                        <p class="setting-desc" data-i18n="setting.llmMode.desc">Select between Standard (OpenAI-like)
                            or Stateful (LM Studio optimized).</p>
                        <select id="cfg-llm-mode" onchange="updateSettingsVisibility()">
                            <option value="standard" data-i18n="setting.llmMode.option.standard">OpenAI Compatible
                            </option>
                            <option value="stateful" data-i18n="setting.llmMode.option.stateful">LM Studio</option>
                        </select>
                    </div>

                    <div class="setting-item" id="container-api-token">
                        <label data-i18n="setting.apiToken.label">API Token</label>
                        <p class="setting-desc" data-i18n="setting.apiToken.desc">LM Studio API Token (Require Auth
                            enabled)</p>
                        <input type="password" id="cfg-api-token" placeholder="Leaving empty uses default"
                            data-i18n-placeholder="setting.apiToken.placeholder">
                    </div>

                    <div class="setting-item" id="container-disable-stateful" style="display: none;">
                        <div class="setting-toggle" onclick="toggleSwitch('cfg-disable-stateful')">
                            <span data-i18n="setting.disableStateful.label">Disable Stateful Storage</span>
                            <input type="checkbox" id="cfg-disable-stateful">
                        </div>
                        <p class="setting-desc" data-i18n="setting.disableStateful.desc">ëŒ€í™” ë‚´ìš©ì„ ì„œë²„ì— ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (LM
                            Studio).</p>
                    </div>

                    <div class="setting-item" id="container-history">
                        <label data-i18n="setting.history.label">History Count</label>
                        <p class="setting-desc" data-i18n="setting.history.desc">(ê¸°ë³¸ê°’: 10) ëŒ€í™” ê¸°ì–µ íšŸìˆ˜</p>
                        <input type="number" id="cfg-history" value="10">
                    </div>

                    <div class="setting-item">
                        <div class="setting-toggle" onclick="toggleSwitch('cfg-hide-think')">
                            <span data-i18n="setting.hideThink.label">Hide &lt;think&gt;</span>
                            <input type="checkbox" id="cfg-hide-think" checked>
                        </div>
                        <p class="setting-desc" data-i18n="setting.hideThink.desc">LLMì´ ìƒê°í•˜ëŠ” ê³¼ì •ì„ ì±„íŒ…ì°½ì— ë³´ì—¬ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.systemPrompt.label">System Prompt</label>
                        <p class="setting-desc" data-i18n="setting.systemPrompt.desc">LLMì˜ ì—­í• ì„ ì§€ì •í•˜ì„¸ìš”. ì˜ˆ: "ë‹¹ì‹ ì€ ë‚˜ì˜ ì˜ì–´
                            ì„ ìƒë‹˜ì…ë‹ˆë‹¤."</p>
                        <select id="cfg-system-prompt-preset" onchange="applySystemPromptPreset(this.value)"
                            style="margin-bottom: 8px; width: 100%; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-color); padding: 8px; border-radius: 6px;">
                            <option value="">Select a preset...</option>
                        </select>
                        <textarea id="cfg-system-prompt" rows="3"
                            placeholder="You are my AI assistant that responds using voice. Please answer in a way that is suitable for text-to-speech, and avoid using tables or other formats that are not suitable for TTS."></textarea>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.temperature.label">Temperature</label>
                        <p class="setting-desc" data-i18n="setting.temperature.desc">(ê¸°ë³¸ê°’: 0.7) ê°’ì´ ë‚®ì„ìˆ˜ë¡ í‰ë²”í•œ ëŒ€ë‹µ, ë†’ì„ìˆ˜ë¡
                            ì°½ì˜ì ì¸ ëŒ€ë‹µ</p>
                        <input type="number" id="cfg-temp" step="0.1" value="0.7">
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.maxTokens.label">Max Tokens</label>
                        <p class="setting-desc" data-i18n="setting.maxTokens.desc">(ê¸°ë³¸ê°’: 4096) LLMì´ ìƒì„±í•  ìµœëŒ€ í† í° ìˆ˜</p>
                        <input type="number" id="cfg-max-tokens" value="2048">
                    </div>
                </div>

                <!-- TTS Settings Section -->
                <div class="setting-section">
                    <div class="setting-section-title" data-i18n="section.tts">TTS Engine</div>

                    <div class="setting-item">
                        <div class="setting-toggle" onclick="toggleSwitch('cfg-enable-tts')">
                            <span data-i18n="setting.enableTTS.label">Enable TTS</span>
                            <input type="checkbox" id="cfg-enable-tts">
                        </div>
                        <p class="setting-desc" data-i18n="setting.enableTTS.desc">ì‘ë‹µì„ ìŒì„±ìœ¼ë¡œ ì¬ìƒí•©ë‹ˆë‹¤.</p>
                    </div>

                    <div class="setting-item">
                        <div class="setting-toggle" onclick="toggleSwitch('cfg-auto-tts')">
                            <span data-i18n="setting.autoPlay.label">Auto-play</span>
                            <input type="checkbox" id="cfg-auto-tts">
                        </div>
                        <p class="setting-desc" data-i18n="setting.autoPlay.desc">ì‘ë‹µì„ ìë™ìœ¼ë¡œ ìŒì„± ì¬ìƒí•©ë‹ˆë‹¤.</p>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.voiceStyle.label">Voice Style</label>
                        <p class="setting-desc" data-i18n="setting.voiceStyle.desc">TTS ìŒì„± ìŠ¤íƒ€ì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.</p>
                        <select id="cfg-tts-voice">
                            <option value="">Loading...</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.speed.label">Speed</label>
                        <p class="setting-desc" data-i18n="setting.speed.desc">ìŒì„± ì¬ìƒ ì†ë„ì…ë‹ˆë‹¤.</p>
                        <div class="slider-row">
                            <input type="range" id="cfg-tts-speed" min="0.5" max="3.0" step="0.1" value="1.0">
                            <span class="slider-value" id="speed-val">1.0</span>
                        </div>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.ttsLang.label">TTS Language</label>
                        <p class="setting-desc" data-i18n="setting.ttsLang.desc">ì„ í˜¸í•˜ëŠ” ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                        <select id="cfg-tts-lang">
                            <option value="ko">í•œêµ­ì–´</option>
                            <option value="en">English</option>
                            <option value="es">EspaÃ±ol</option>
                            <option value="fr">FranÃ§ais</option>
                            <option value="pt">PortuguÃªs</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.chunkSize.label">Smart Chunking</label>
                        <p class="setting-desc" data-i18n="setting.chunkSize.desc">(ì¶”ì²œê°’: 150~300) TTSê°€ ëª‡ ê¸€ìì”© ì˜ë¼ ìƒì„±í• ì§€ ì§€ì •
                        </p>
                        <input type="number" id="cfg-chunk-size" value="300" min="50" max="1000">
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.steps.label">Inference Steps</label>
                        <p class="setting-desc" data-i18n="setting.steps.desc">(ì¶”ì²œê°’: 2~8, ê¸°ë³¸ê°’: 5) ë†’ì„ìˆ˜ë¡ ìì—°ìŠ¤ëŸ¬ìš´ ìŒì„±</p>
                        <div class="slider-row">
                            <input type="range" id="cfg-tts-steps" min="1" max="50" step="1" value="5">
                            <span class="slider-value" id="steps-val">5</span>
                        </div>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.threads.label">CPU Threads</label>
                        <p class="setting-desc" data-i18n="setting.threads.desc">(ê¸°ë³¸ê°’: 4) TTS ìƒì„±ì— í• ë‹¹í•˜ëŠ” CPU ìŠ¤ë ˆë“œ</p>
                        <div class="slider-row">
                            <input type="range" id="cfg-tts-threads" min="1" max="16" step="1" value="4">
                            <span class="slider-value" id="threads-val">4</span>
                        </div>
                    </div>

                    <div class="setting-item">
                        <label data-i18n="setting.format.label">Audio Format</label>
                        <p class="setting-desc" data-i18n="setting.format.desc">MP3ëŠ” WAVë¥¼ ë³€í™˜í•˜ì—¬ ì¬ìƒí•©ë‹ˆë‹¤.</p>
                        <select id="cfg-tts-format">
                            <option value="wav">WAV (Original)</option>
                            <option value="mp3-high">MP3 (High - 128kbps)</option>
                            <option value="mp3-medium">MP3 (Medium - 96kbps)</option>
                            <option value="mp3-low">MP3 (Low - 32kbps)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-footer-buttons">
                    <button class="btn btn-secondary btn-lg" onclick="closeSettingsModal()">
                        <span class="material-icons-round">close</span>
                        <span data-i18n="action.cancel">ì·¨ì†Œ</span>
                    </button>
                    <button class="btn btn-secondary btn-lg" onclick="reloadExternalFiles()"
                        title="Reload prompts and dictionary">
                        <span class="material-icons-round">refresh</span>
                        <span data-i18n="action.reload">ìƒˆë¡œê³ ì¹¨</span>
                    </button>
                    <button class="btn btn-primary btn-lg" id="save-cfg-btn">
                        <span class="material-icons-round">save</span>
                        <span data-i18n="action.save">ì €ì¥</span>
                    </button>
                </div>
                <button class="btn btn-logout" onclick="logout()" style="margin-top: 8px;">
                    <span class="material-icons-round">logout</span>
                    <span data-i18n="action.logout">ë¡œê·¸ì•„ì›ƒ</span>
                </button>
                <div class="modal-footer-info">
                    &copy; 2026 DINKI'ssTyle
                </div>
            </div>
        </div>
    </div>

    <!-- Main Chat -->
    <div id="main-chat">
        <div id="chat-header">
            <span id="header-model-name" class="header-model-name">Loading...</span>
            <div style="display: flex; gap: 4px;">
                <button class="icon-btn" onclick="clearChat()" title="Clear Chat">
                    <span class="material-icons-round">delete_outline</span>
                </button>
                <button class="icon-btn" onclick="openSettingsModal()" title="Settings">
                    <span class="material-icons-round">settings</span>
                </button>
            </div>
        </div>

        <div id="chat-messages">
            <!-- Messages will be injected here -->
            <!-- Messages will be injected here -->

        </div>

        <div id="preview-container">
            <div class="preview-wrapper">
                <img id="image-preview" class="preview-img" src="" alt="Preview">
                <div class="remove-img-btn" onclick="removeImage()">
                    <span class="material-icons-round">close</span>
                </div>
            </div>
        </div>

        <div id="input-area">
            <div class="input-container">
                <textarea id="message-input" rows="1" placeholder="Type a message..."
                    data-i18n-placeholder="input.placeholder"></textarea>

                <div class="input-actions">
                    <input type="file" id="image-upload" accept="image/*" style="display: none"
                        onchange="handleImageUpload(this)">
                    <button class="icon-btn" onclick="document.getElementById('image-upload').click()"
                        title="Upload Image">
                        <span class="material-icons-round">add_photo_alternate</span>
                    </button>
                    <button class="icon-btn send-btn" id="send-btn" title="Send Message">
                        <span class="material-icons-round">send</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="app.js"></script>

</body>

</html>